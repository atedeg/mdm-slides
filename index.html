<!doctype html><html lang=en><head><meta name=generator content="Hugo 0.101.0"><meta charset=utf-8><title>MDM üßÄ</title><meta name=description content="Mambelli Domain Model"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="black-translucent"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><link rel=stylesheet href=/mdm-slides/reveal-js/css/reset.css><link rel=stylesheet href=/mdm-slides/reveal-js/css/reveal.css><link rel=stylesheet href=/mdm-slides/css/custom-theme.min.c2c8c539ccf2d1b64d02e34dfb2668e80d2050c29e6cdc31248f5a0f5393c8a8.css id=theme><link rel=stylesheet href=/mdm-slides/highlight-js/solarized-light.min.css></head><body><div class=reveal><div class=slides><section><img class=mdm-logo src=img/logo.svg alt=MDM><p class=mdm-title>Mambelli Domain Model</p><p class=avatar-container><img class=avatar src="https://avatars.githubusercontent.com/u/20598369?v=4" alt=giacomo-avatar>
<img class=avatar src="https://avatars.githubusercontent.com/u/4855008?v=4" alt=nicolo-avatar>
<img class=avatar src="https://avatars.githubusercontent.com/u/11615611?v=4" alt=nicolas-avatar>
<img class=avatar src="https://avatars.githubusercontent.com/u/62563336?v=4" alt=linda-avatar></p></section><section><h1 id=introduction>Introduction</h1><p>We decided to model the domain of the <a href=https://mambelli.com><em>Mambelli</em></a> cheese factory:<br>a small family business that produces and sells cheese.</p><p>We chose this domain because:</p><ul><li>It is quite complex</li><li>There are domain experts that could help us</li><li>We ‚ù§Ô∏è cheese</li></ul></section><section><section data-shortcode-section><h1 id=domain-modeling>Domain Modeling</h1><img class=stretch src=img/event-storming-session.gif alt="event storming session"></section><section><h2 id=event-storming>Event Storming</h2><img class="stretch no-border" src=img/event-storming.svg alt="event storming diagram"></section><section><h2 id=core-domain-chart>Core Domain Chart</h2><img class="stretch no-border" src=img/core-domain-chart.svg alt="core domain chart"></section><section><h2 id=bounded-contexts>Bounded Contexts</h2><p>TODO: add context map</p></section><section><h2 id=user-stories>User Stories</h2><p>TODO: add user stories</p></section></section><section><section data-shortcode-section><h1 id=architecture>Architecture</h1></section><section><h2 id=clean-architecture>Clean Architecture</h2><img class="stretch no-border" src=img/clean-architecture.svg alt="clean architecture"></section></section><section><section data-shortcode-section><h1 id=devops>DevOps</h1></section><section><h2 id=dvcs-workflow>DVCS Workflow</h2><p>We adopt a <code>git-flow</code>-like workflow with a <code>beta</code> branch for pre-releases and a <code>main</code> branch for the stable ones.</p><div class=mermaid>%%{init: {'theme':'base'}}%%
gitGraph
commit id: "chore: ..."
commit id: "build: ..."
commit id: "chore: ..."
commit id: "ci: ..."
branch beta
commit tag: "1.0.0-beta.1"
branch feat/feature-1
checkout feat/feature-1
commit id: "feat: feature 1"
commit id: "feat: feature 2"
checkout beta
merge feat/feature-1 tag: "1.0.0-beta.2"
branch feat/feature-2
commit id: "feat: feature 3"
checkout beta
merge feat/feature-2 tag: "1.0.0-beta.3"
checkout main
merge beta tag: "1.0.0"
branch fix/fix-2
commit id: "fix: fix1"
commit id: "fix: fix2"
checkout main
merge fix/fix-2 tag: "1.0.1"</div></section><section><h2 id=conventional-commit>Conventional Commit</h2><p>Why use <code>conventional commit</code>?</p><ul><li>Automatically determining a semantic version bump</li><li>Triggering build and publish processes (with external tools)</li><li>Automatically generating CHANGELOGs</li><li>More understandable commit history</li></ul><p>How to enforce the use of <code>conventional commit</code>?</p><p>A <a href=https://github.com/nicolasfara/conventional-commits><em>gradle plugin</em></a>
and an <a href=https://github.com/nicolasfara/sbt-conventional-commits><em>sbt plugin</em></a>
have been developed.</p></section><section><h2 id=semantic-release>Semantic Release</h2><p><code>semantic-release</code> automates the whole package release workflow:</p><ul><li>Determines the next version number</li><li>Generates the release notes</li><li>Publish the package</li></ul><p>The use of <strong>Conventional Commits</strong> combined with <strong>Semantic Release</strong> helped us to automate the release process.</p></section><section><h2 id=quality-assurance>Quality Assurance</h2><p>Code quality is an important aspect, so the following tools have been used:</p><ul><li><a href=https://www.wartremover.org/>Wartremover</a></li><li><a href=https://scalacenter.github.io/scalafix/>Scalafix</a></li><li><a href=https://scalameta.org/scalafmt/>Scalafmt</a></li></ul><p>Each of these tools is used in CI to prevent the merge of bad code.</p></section><section><h2 id=continuous-integration-and-deployment>Continuous Integration and Deployment</h2><p>The following workflow is the result of a pipeline optimization that seeks to take full advantage of the parallelism between jobs:</p><div class=mermaid>%%{init: {'theme':'base'}}%%
flowchart LR
SFMT(Scalafmt) --> B
SFX(Scalafix) --> B
WRM(Wartremover) --> B
T(Unit test) --> Cov(Coverage Report)
Cov --> B
A(Documentation site)-->B(Publish)
B --> C(Publish site)</div><p>To simplify the <code>Publish</code> job, the <a href=https://github.com/atedeg/scala-release><code>scala-release</code></a> action was developed.</p></section></section><section><section data-shortcode-section><h1 id=development-choices>Development Choices</h1></section><section><h2 id=domain-modeling-approach>Domain Modeling Approach</h2><p>All core domain concepts are modelled using simple ADTs to keep
them as simple and adherent to the expert&rsquo;s definition as possible:</p><pre><code class=language-scala data-line-numbers>enum Batch:
  case Aging(id: BatchID, cheeseType: CheeseType, readyFrom: LocalDateTime)
  case ReadyForQualityAssurance(id: BatchID, cheeseType: CheeseType)
</code></pre><p>instead of the possibly confusing:</p><pre><code class=language-scala data-line-numbers>final case class Batch(
  id: BatchID,
  cheeseType: CheeseType,
  isAging: Bool,
  readyFrom: Option[LocalDateTime], // only defined if isAging 
)
</code></pre><aside class=notes><ul><li>La prima esprime chiaramente i possibili stati in cui si pu√≤ trovare un lotto</li><li>Non ci possono essere stati incoerenti</li><li>La definizione √® pi√π semplice e lineare da leggere anche per un esperto di dominio</li></ul></aside></section><section><p>All primitive types are not only wrapped in appropriate value objects but also enriched
with compile-time-checked predicates:</p><pre><code class=language-scala data-line-numbers>type PositiveNumber = Int Refined Positive
final case class InStockQuantity(n: PositiveNumber)
</code></pre><p>instead of:</p><pre><code class=language-scala data-line-numbers>final case class InStockQuantity private(n: Int)
object InStockQuantity:
  def apply(n: Int): Option[InStockQuantity] =
    if n &lt; 0 then None else Some(InStockQuantity(n))
</code></pre><aside class=notes><ul><li>Modellazione pi√π chiara, facile da leggere anche per un esperto di dominio</li><li>Esprime chiaramente delle invarianti importanti a livello di type signature</li><li>Non c&rsquo;√® bisogno di andare a leggere il codice del costruttore</li><li>Meno test da scrivere perch√© non c&rsquo;√® un costruttore la cui implementazione potrebbe
erroneamente cambiare nel tempo</li><li>Pi√π errori catturati compile-time</li></ul></aside></section><section><h2 id=side-effect-encoding-via-monads>Side-effect Encoding via Monads</h2><p>All core domain actions use a monadic encoding of side-effects: all side effects are reified
(using an <a href=https://typelevel.org/cats-mtl/getting-started.html><code>mtl</code></a>-style encoding)
and expressed in the type signature of the function.</p><pre><code class=language-scala data-line-numbers=|1|1,5|1,7|>def labelProduct[M[_]: CanRaise[WeightNotInRange]: CanEmit[ProductStocked]: Monad]
  (...): M[LabelledProduct] =
for
  ...
  product &lt;- optionalProduct.ifMissingRaise(WeightNotInRange(...): WeightNotInRange)
  labelledProduct = LabelledProduct(product, AvailableQuantity(1), batch.id)
  _ &lt;- emit(ProductStocked(labelledProduct): ProductStocked)
yield labelledProduct
</code></pre><aside class=notes><ul><li>Modellazione pi√π chiara, isola ed esprime chiaramente i side effect</li><li>DSL monadico per scrivere codice che sia pi√π facilmente comprensibile</li><li>Reificando i side effect diventa molto semplice testare le diverse azioni isolandole fra loro</li></ul></aside></section><section><h2 id=dtos>DTOs</h2><p>Accennare senza dilungarsi troppo!</p></section><section><h2 id=http-api>HTTP API</h2></section><section><h2 id=documentation>Documentation</h2><p>All ubiquitous language concepts are mirrored by a corresponding ADT in the code.
Keeping the code and the ubiquitous language up-to-date can be a difficult task.</p></section></section><section><h1 id=license>License</h1><p>The open licence that best suited our needs was the
<a href=https://www.apache.org/licenses/LICENSE-2.0>Apache Licence 2.0</a>:<br>our codebase could contain refences to the Mambelli trademark
and this licence does not grant permission to it<br><em>"&mldr;except as required for reasonable and customary use</em><br><em>in describing the origin of the Work&mldr;"</em></p></section></div></div><script type=text/javascript src=/mdm-slides/reveal-hugo/object-assign.js></script>
<a href=/mdm-slides/reveal-js/css/print/ id=print-location style=display:none></a>
<script type=text/javascript>var printLocationElement=document.getElementById("print-location"),link=document.createElement("link");link.rel="stylesheet",link.type="text/css",link.href=printLocationElement.href+(window.location.search.match(/print-pdf/gi)?"pdf.css":"paper.css"),document.getElementsByTagName("head")[0].appendChild(link)</script><script type=application/json id=reveal-hugo-site-params>{"height":"900","highlight_theme":"solarized-light","theme":"white","width":"1440"}</script><script type=application/json id=reveal-hugo-page-params>{"custom_theme":"custom-theme.scss","custom_theme_compile":"true","custom_theme_options":{"enablesourcemap":true,"targetpath":"css/custom-theme.css"},"transition":"slide","transition_speed":"fast"}</script><script src=/mdm-slides/reveal-js/js/reveal.js></script>
<script type=text/javascript>function camelize(e){return e&&Object.keys(e).forEach(function(t){newK=t.replace(/(_\w)/g,function(e){return e[1].toUpperCase()}),newK!=t&&(e[newK]=e[t],delete e[t])}),e}var revealHugoDefaults={center:!0,controls:!0,history:!0,progress:!0,transition:"slide"},revealHugoSiteParams=JSON.parse(document.getElementById("reveal-hugo-site-params").innerHTML),revealHugoPageParams=JSON.parse(document.getElementById("reveal-hugo-page-params").innerHTML),options=Object.assign({},camelize(revealHugoDefaults),camelize(revealHugoSiteParams),camelize(revealHugoPageParams));Reveal.initialize(options)</script><script type=text/javascript src=/mdm-slides/reveal-js/plugin/markdown/marked.js></script>
<script type=text/javascript src=/mdm-slides/reveal-js/plugin/markdown/markdown.js></script>
<script type=text/javascript src=/mdm-slides/reveal-js/plugin/highlight/highlight.js></script>
<script type=text/javascript src=/mdm-slides/reveal-js/plugin/zoom-js/zoom.js></script>
<script type=text/javascript src=/mdm-slides/reveal-js/plugin/notes/notes.js></script>
<script src=https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js></script>
<script>mermaid.initialize({startOnLoad:!1});let render=e=>{let t=e.currentSlide.querySelectorAll(".mermaid");if(!t.length)return;t.forEach(e=>{let t=e.getAttribute("data-processed");t||mermaid.init(void 0,e)})};Reveal.addEventListener("slidechanged",render),Reveal.addEventListener("ready",render)</script><script>MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]]},"HTML-CSS":{linebreaks:{automatic:!0}},svg:{fontCache:"global",linebreaks:{automatic:!0}}}</script><script type=text/javascript id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js></script></body></html>